---
import { t } from "i18next";
import TitleSection from "./widgets/TitleSection.astro";
import NoticiasGrupo from "./NoticiasGrupo.astro";

import { contentfulClient } from "../lib/contentful";
import type { Noticia } from "../lib/contentful";

const entries = await contentfulClient.getEntries<Noticia>({
  content_type: "noticias",
});

const posts = entries.items.map((item) => {
  const { imagenPortada, fecha, titulo, descripcion, url  } = item.fields;
  return {
    imagenPortada,
    fecha: new Date(fecha).toLocaleDateString(),
    titulo,
    descripcion,
    url
  };
});
---

<section id={t("navbar.noticias")} class="flex justify-center">
  <div
    class="flex flex-col sm:flex-row gap-4 items-center text-black max-w-screen-xl p-8 max-m-32 md:m-12 rounded-xl"
  >
    <div class="container mx-auto p-8">
      <div class="-mx-4 flex flex-wrap justify-center">
        <div class="w-full">
          <div
            class="flex flex-col justify-center items-center mx-auto mb-8 max-w-[510px] text-center"
          >
            <TitleSection title={t("titulos.noticias")} />

            <p class="mt-4 max-w-lg sm:text-xl">
              There are many variations of passages of Lorem Ipsum available but
              the majority have suffered alteration in some form.
            </p>
          </div>
        </div>
      </div>
      <div class="-mx-4 flex flex-wrap">
        {posts.map((post) => (
          <NoticiasGrupo
            imagen={post.imagenPortada.fields.file.url}
            fecha={post.fecha}
            titulo={post.titulo}
            descripcion={post.descripcion}
            url={post.url}
          />
          ))}
        <!-- {
          <NoticiasGrupo
            imagen={entries.items[0].fields.imagen.fields.file.url}
            fecha={entries.items[0].fields.fecha}
            titulo={entries.items[0].fields.titulo}
            descripcion={entries.items[0].fields.descripcion}
          />
        } -->
        <!-- {
          entries.items.map((item) => (
              <NoticiasGrupo
                imagen={item.fields.imagen.fields.file.url}
                fecha={item.fields.fecha}
                titulo={item.fields.titulo}
                descripcion={item.fields.descripcion}
              />
          ))
        } -->
      </div>
    </div>
  </div>
</section>
